<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Budget Tracker</title>

    <!-- Boxicons (for sidebar icons, same as other pages) -->
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"/>

    <!-- Shared app styles -->
    <link rel="stylesheet" href="css/dashboard.css" />
    <link rel="stylesheet" href="css/budget.css" />

    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  </head>

  <body class="budget-page">
    <!-- ===== SIDEBAR (same shell as dashboard) ===== -->
    <aside class="sidebar" id="sidebar">
      <div class="logo">
        <i class="bx bx-cube-alt"></i>
      </div>

      <nav class="menu">
        <h1 class="menu-header">Menu</h1>

        <div class="menu-item" data-link="dashboard" data-tooltip="Dashboard">
          <i class="bx bx-home-smile"></i>
          <a href="/dashboard" style="text-decoration:none;color:inherit">
            <span>Dashboard</span>
          </a>
        </div>

        <div class="menu-item" data-link="income" data-tooltip="Income">
          <i class="bx bx-bar-chart-alt-2"></i>
          <a href="/income" style="text-decoration:none;color:inherit">
            <span>Income</span>
          </a>
        </div>

        <div class="menu-item" data-link="expense" data-tooltip="Expense">
          <i class="bx bx-cart"></i>
          <a href="/expense" style="text-decoration:none;color:inherit">
            <span>Expense</span>
          </a>
        </div>

        <div
          class="menu-item nav-active"
          data-link="budget-tracker"
          data-tooltip="Budget Tracker"
        >
          <i class="bx bx-category-alt"></i>
          <a
            href="/budget-tracker"
            style="text-decoration:none;color:inherit"
          >
            <span>Budget Tracker</span>
          </a>
        </div>

        <div class="menu-item" data-link="report" data-tooltip="Budget Report">
          <i class="bx bx-line-chart"></i>
          <a href="/report" style="text-decoration:none;color:inherit">
            <span>Budget Report</span>
          </a>
        </div>
      </nav>

      <div class="logout" data-tooltip="Logout" id="logoutLink">
        <i class="bx bx-log-out"></i><span>Logout</span>
      </div>
    </aside>

    <!-- ===== MAIN CONTENT (matches dashboard layout) ===== -->
    <main class="dashboard-content">
      <!-- Header -->
      <div class="header">
        <h1>Budget Tracker</h1>
        <div>
          <button id="refreshButton">Refresh</button>
          <button id="logoutButton">Log Out</button>
        </div>
      </div>

      <!-- Budget layout -->
      <main class="dashboard">
        <!-- LEFT HALF (2x2 GRID) -->
        <section class="left-grid">
          <!-- Top Left: Budget Setup -->
          <div id="budget-setup" class="card">
            <h2>Set Your Budget</h2>

            <form id="budgetForm">
              <label for="category-select">Category</label>
              <select id="category-select" class="input-field" required>
                <option value="" disabled selected>Select category</option>
                <option value="Rent">Rent</option>
                <option value="Utilities">Utilities</option>
                <option value="Food/Groceries">Food/Groceries</option>
                <option value="Transportation">Transportation</option>
                <option value="Entertainment">Entertainment</option>
                <option value="Savings">Savings</option>
                <option value="Other">Other</option>
                <option value="custom">Custom</option>
              </select>

              <input
                type="text"
                id="category-custom"
                class="input-field"
                placeholder="Enter custom category"
                style="display:none;"
              />

              <label for="budget-amount" style="margin-top:12px;"
                >Budget Amount ($)</label
              >
              <input type="text" id="budget-amount" class="input-field" />

              <button type="submit" class="btn-primary">Add Budget</button>
            </form>
          </div>

          <!-- Top Right: Add Income / Expense -->
          <div id="transactions" class="card">
            <h2>Add Income or Expense</h2>
            <form id="transactionForm">
              <div class="input-group">
                <label for="type">Type</label>
                <select id="type" required>
                  <option value="income">Income</option>
                  <option value="expense">Expense</option>
                </select>
              </div>

              <div class="input-group">
                <label for="amount">Amount ($)</label>
                <input
                type="text"
                id="amount"
                class="input-field"
                required
                />
              </div>


              <div class="input-group">
                <label for="trans-category">Category</label>
                <input
                  type="text"
                  id="trans-category"
                  list="expenseCategories"
                  placeholder="Start typing to search..."
                  required
                />
                <datalist id="expenseCategories">
                  <option value="Rent"></option>
                  <option value="Utilities"></option>
                  <option value="Food/Groceries"></option>
                  <option value="Transportation"></option>
                  <option value="Entertainment"></option>
                  <option value="Savings"></option>
                  <option value="Other"></option>
                </datalist>
              </div>

              <button type="submit" class="btn-primary">
                Add Transaction
              </button>
            </form>
          </div>

          <!-- Bottom Left: Transaction Log -->
          <div id="log" class="card">
            <h2>Transaction Log</h2>
            <ul id="transaction-list"></ul>
          </div>

          <!-- Bottom Right: Budget Summary -->
           <div id="summary" class="card budget-summary-card">
            <div class="summary-header">
              <h2>Budget Summary</h2>
              <p class="summary-subtitle">Quick snapshot</p>
            </div>
            
            <div class="summary-body">
              <div class="summary-item">
                <div class="summary-label">
                  <span class="summary-tag income-tag">Income</span>
                  <p>Total Income</p>
                </div>
                <span class="summary-value" id="total-income">$0.00</span>
              </div>

    <div class="summary-item">
      <div class="summary-label">
        <span class="summary-tag expense-tag">Expenses</span>
        <p>Total Expenses</p>
      </div>
      <span class="summary-value" id="total-expenses">$0.00</span>
    </div>

    <div class="summary-item balance-row">
      <div class="summary-label">
        <span class="summary-tag balance-tag">Balance</span>
        <p>Remaining Balance</p>
      </div>
      <span class="summary-value" id="remaining-balance">$0.00</span>
    </div>
  </div>
</div>

        </section>

        <!-- RIGHT HALF (Pie Chart) -->
        <section id="spending-visual" class="card">
          <h2>Spending by Category</h2>
          <p class="subtitle">
            Visual breakdown of your spending and budget allocation.
          </p>
          <canvas id="spendingChart"></canvas>
        </section>
      </main>
    </main>

    <script defer src="js/budget.js"></script>

    <!-- Sidebar highlighting + Logout + Refresh -->
    <script>
      (function () {
        const path = location.pathname;
        const map = {
          "/dashboard": "dashboard",
          "/income": "income",
          "/expense": "expense",
          "/budget-tracker": "budget-tracker",
          "/report": "report",
        };

        const key = map[path];
        if (key) {
          document
            .querySelector('.menu .menu-item[data-link="' + key + '"]')
            ?.classList.add("nav-active");
        }

        // Sidebar logout
        document.getElementById("logoutLink")?.addEventListener("click", () => {
          localStorage.removeItem("token");
          localStorage.removeItem("jwtToken");
          location.href = "/";
        });

        // Top-right logout
        document
          .getElementById("logoutButton")
          ?.addEventListener("click", () => {
            localStorage.removeItem("token");
            localStorage.removeItem("jwtToken");
            location.href = "/";
          });

        // Refresh button
        document
          .getElementById("refreshButton")
          ?.addEventListener("click", () => location.reload());
      })();
    </script>
  </body>
</html>
