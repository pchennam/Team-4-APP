<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>

    <!-- CSS -->
    <link rel="stylesheet" href="/css/dashboard.css" />
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet"/>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>

  <body class="dashboard-page">
    <!-- Sidebar -->
<aside class="sidebar" id="sidebar">
  <div class="logo"><i class="bx bx-cube-alt"></i></div>

  <nav class="menu">
    <h1 class="menu-header">Menu</h1>

    <div class="menu-item" data-link="dashboard" data-tooltip="Dashboard">
      <i class="bx bx-home-smile"></i>
      <a href="/dashboard" style="text-decoration:none;color:inherit">
        <span>Dashboard</span>
      </a>
    </div>

    <div class="menu-item" data-link="income" data-tooltip="Income">
      <i class="bx bx-bar-chart-alt-2"></i>
      <a href="/income" style="text-decoration:none;color:inherit">
        <span>Income</span>
      </a>
    </div>

    <div class="menu-item" data-link="expense" data-tooltip="Expense">
      <i class="bx bx-cart"></i>
      <a href="/expense" style="text-decoration:none;color:inherit">
        <span>Expense</span>
      </a>
    </div>

    <!-- â­ NEW ITEM: Budget Tracker -->
    <div class="menu-item" data-link="budget-tracker" data-tooltip="Budget Tracker">
      <i class="bx bx-category-alt"></i>
      <a href="/budget-tracker" style="text-decoration:none;color:inherit">
        <span>Budget Tracker</span>
      </a>
    </div>

    <!-- Existing Budget Report -->
    <div class="menu-item" data-link="report" data-tooltip="Budget Report">
      <i class="bx bx-line-chart"></i>
      <a href="/report" style="text-decoration:none;color:inherit">
        <span>Budget Report</span>
      </a>
    </div>
  </nav>

  <div class="logout" data-tooltip="Logout" id="logoutLink">
    <i class="bx bx-log-out"></i><span>Logout</span>
  </div>
</aside>



    <!-- Main Content -->
    <main class="dashboard-content">
      <div class="header">
        <h1>Welcome, <span id="userName">User</span>!</h1>
        <div>
          <button id="refreshButton">Refresh</button>
          <button id="logoutButton">Log Out</button>
        </div>
      </div>

      <!-- KPI Cards -->
      <div class="kpi-cards">
        <div class="card income">
          <h2>Total Income</h2>
          <p id="kpiIncome">No data</p>
        </div>
        <div class="card expenses">
          <h2>Total Expenses</h2>
          <p id="kpiExpenses">No data</p>
        </div>
        <div class="card budget">
          <h2>Monthly Budget</h2>
          <p id="kpiBudget">No data</p>
        </div>
      </div>

      <!-- Charts: keep three cards, only income is populated -->
     <div class="charts-grid">
<!-- Monthly Income -->
<div class="chart-box">
  <div class="chart-title">Monthly Income Trend</div>
  <canvas id="incomeChart"></canvas>
</div>

<!-- Expense Breakdown -->
<div class="chart-box">
  <div class="chart-title">Expense Breakdown by Category</div>
  <canvas id="categoryChart"></canvas>
</div>

<!-- Budget vs Actual -->
<div class="chart-box">
  <div class="chart-title">Budget vs Actual</div>
  <canvas id="budgetVsActualChart"></canvas>
</div>


    </main>

    <!-- Scripts -->
    <script src="/js/datamodel.js"></script>
    <script src="/js/dashboard.js"></script>
        <script>
    (function () {
      const path = location.pathname;
      const map = {
        '/dashboard': 'dashboard',
        '/income': 'income',
        '/expense': 'expense',
        '/budget-tracker': 'budget-tracker',
        '/report': 'report',
      };
      const key = map[path];
      if (key) {
        document
        .querySelector(`.menu .menu-item[data-link="${key}"]`)
        ?.classList.add('nav-active');
      }

    // Consistent logout
    document.getElementById('logoutLink')?.addEventListener('click', () => {
      localStorage.removeItem('token');
      localStorage.removeItem('jwtToken');
      location.href = '/';
    });
    })();
    </script>
  </body>
</html>
